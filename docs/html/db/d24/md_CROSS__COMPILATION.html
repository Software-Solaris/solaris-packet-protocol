<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Solaris Packet Protocol: SPP Cross-Compilation Guide</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../SPP_logo.jpeg"/></td>
  <td id="projectalign">
   <div id="projectname">Solaris Packet Protocol<span id="projectnumber">&#160;0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">SPP Cross-Compilation Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a> This guide details how to compile the Solaris Packet Protocol (SPP) library for different architectures using cross-compilation.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Supported Architectures</h1>
<h2><a class="anchor" id="autotoc_md2"></a>
ARM (32-bit)</h2>
<ul>
<li><b>Toolchain</b>: <code>arm-linux-gnueabihf-gcc</code></li>
<li><b>Architecture</b>: ARMv7-A with NEON</li>
<li><b>ABI</b>: Hard float</li>
</ul>
<h2><a class="anchor" id="autotoc_md3"></a>
RISC-V (64-bit)</h2>
<ul>
<li><b>Toolchain</b>: <code>riscv64-linux-gnu-gcc</code></li>
<li><b>Architecture</b>: RV64GC</li>
<li><b>ABI</b>: LP64D</li>
</ul>
<h1><a class="anchor" id="autotoc_md4"></a>
Toolchain Installation</h1>
<h2><a class="anchor" id="autotoc_md5"></a>
Ubuntu/Debian</h2>
<div class="fragment"><div class="line"># For ARM</div>
<div class="line">sudo apt-get update</div>
<div class="line">sudo apt-get install gcc-arm-linux-gnueabihf g++-arm-linux-gnueabihf</div>
<div class="line"> </div>
<div class="line"># For RISC-V</div>
<div class="line">sudo apt-get install gcc-riscv64-linux-gnu g++-riscv64-linux-gnu</div>
<div class="line"> </div>
<div class="line"># Verify installation</div>
<div class="line">arm-linux-gnueabihf-gcc --version</div>
<div class="line">riscv64-linux-gnu-gcc --version</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
Fedora/CentOS/RHEL</h2>
<div class="fragment"><div class="line"># For ARM</div>
<div class="line">sudo dnf install gcc-arm-linux-gnu g++-arm-linux-gnu</div>
<div class="line"> </div>
<div class="line"># For RISC-V</div>
<div class="line">sudo dnf install gcc-riscv64-linux-gnu g++-riscv64-linux-gnu</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md7"></a>
Cross-Compilation</h1>
<h2><a class="anchor" id="autotoc_md8"></a>
Method 1: Automated Script (Recommended)</h2>
<div class="fragment"><div class="line"># ARM</div>
<div class="line">./build.sh -x arm -t Release</div>
<div class="line"> </div>
<div class="line"># RISC-V</div>
<div class="line">./build.sh -x riscv64 -t Release</div>
<div class="line"> </div>
<div class="line"># With additional options</div>
<div class="line">./build.sh -x arm -t Debug -v -p /opt/spp-arm</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md9"></a>
Method 2: Manual CMake</h2>
<div class="fragment"><div class="line"># ARM</div>
<div class="line">mkdir build-arm</div>
<div class="line">cd build-arm</div>
<div class="line">cmake -DCMAKE_TOOLCHAIN_FILE=../cmake/toolchains/arm-linux-gnueabihf.cmake \</div>
<div class="line">      -DCMAKE_BUILD_TYPE=Release \</div>
<div class="line">      -DCMAKE_INSTALL_PREFIX=/opt/spp-arm \</div>
<div class="line">      ..</div>
<div class="line">make -j$(nproc)</div>
<div class="line"> </div>
<div class="line"># RISC-V</div>
<div class="line">mkdir build-riscv64</div>
<div class="line">cd build-riscv64</div>
<div class="line">cmake -DCMAKE_TOOLCHAIN_FILE=../cmake/toolchains/riscv64-linux-gnu.cmake \</div>
<div class="line">      -DCMAKE_BUILD_TYPE=Release \</div>
<div class="line">      -DCMAKE_INSTALL_PREFIX=/opt/spp-riscv \</div>
<div class="line">      ..</div>
<div class="line">make -j$(nproc)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md10"></a>
Creating Custom Toolchain</h1>
<h2><a class="anchor" id="autotoc_md11"></a>
Example for a new architecture</h2>
<div class="fragment"><div class="line"># cmake/toolchains/my-architecture.cmake</div>
<div class="line"> </div>
<div class="line">set(CMAKE_SYSTEM_NAME Linux)</div>
<div class="line">set(CMAKE_SYSTEM_PROCESSOR my_arch)</div>
<div class="line"> </div>
<div class="line"># Specify compilers</div>
<div class="line">set(CMAKE_C_COMPILER my-arch-gcc)</div>
<div class="line">set(CMAKE_CXX_COMPILER my-arch-g++)</div>
<div class="line"> </div>
<div class="line"># Configure sysroot if needed</div>
<div class="line">set(CMAKE_SYSROOT /path/to/sysroot)</div>
<div class="line"> </div>
<div class="line"># Configure search paths</div>
<div class="line">set(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER)</div>
<div class="line">set(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY)</div>
<div class="line">set(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)</div>
<div class="line">set(CMAKE_FIND_ROOT_PATH_MODE_PACKAGE ONLY)</div>
<div class="line"> </div>
<div class="line"># Architecture-specific flags</div>
<div class="line">set(CMAKE_C_FLAGS &quot;${CMAKE_C_FLAGS} -march=my-arch-flags&quot;)</div>
<div class="line">set(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} -march=my-arch-flags&quot;)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md12"></a>
Using custom toolchain</h2>
<div class="fragment"><div class="line">./build.sh -T cmake/toolchains/my-architecture.cmake</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md13"></a>
Cross-Compilation Verification</h1>
<h2><a class="anchor" id="autotoc_md14"></a>
Verify library architecture</h2>
<div class="fragment"><div class="line"># For ARM</div>
<div class="line">file build-arm/core/libspp_core.a</div>
<div class="line">file build-arm/services/databank/libspp_databank.a</div>
<div class="line"> </div>
<div class="line"># For RISC-V</div>
<div class="line">file build-riscv64/core/libspp_core.a</div>
<div class="line">file build-riscv64/services/databank/libspp_databank.a</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md15"></a>
Verify symbols</h2>
<div class="fragment"><div class="line"># List symbols in library</div>
<div class="line">nm build-arm/core/libspp_core.a</div>
<div class="line">objdump -t build-arm/core/libspp_core.a</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md16"></a>
Cross-Compiled Installation</h1>
<h2><a class="anchor" id="autotoc_md17"></a>
Local installation</h2>
<div class="fragment"><div class="line"># After building</div>
<div class="line">cd build-arm</div>
<div class="line">sudo make install</div>
<div class="line"> </div>
<div class="line"># Or with CMake</div>
<div class="line">sudo cmake --install . --prefix /opt/spp-arm</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md18"></a>
Packaging for distribution</h2>
<div class="fragment"><div class="line"># Create tar package</div>
<div class="line">cd build-arm</div>
<div class="line">make install DESTDIR=/tmp/spp-arm-package</div>
<div class="line">cd /tmp/spp-arm-package</div>
<div class="line">tar -czf spp-arm-1.0.0.tar.gz *</div>
<div class="line"> </div>
<div class="line"># Create deb package (if you have checkinstall)</div>
<div class="line">cd build-arm</div>
<div class="line">sudo checkinstall --pkgname=spp-arm --pkgversion=1.0.0</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md19"></a>
Usage in Target Project</h1>
<h2><a class="anchor" id="autotoc_md20"></a>
CMakeLists.txt for cross-compiled project</h2>
<div class="fragment"><div class="line">cmake_minimum_required(VERSION 3.16)</div>
<div class="line">project(MyARMProject LANGUAGES C)</div>
<div class="line"> </div>
<div class="line"># Use the same toolchain</div>
<div class="line">set(CMAKE_TOOLCHAIN_FILE &quot;path/to/arm-linux-gnueabihf.cmake&quot;)</div>
<div class="line"> </div>
<div class="line"># Configure SPP path</div>
<div class="line">set(CMAKE_PREFIX_PATH &quot;/opt/spp-arm&quot;)</div>
<div class="line"> </div>
<div class="line">find_package(spp REQUIRED)</div>
<div class="line"> </div>
<div class="line">add_executable(my_app main.c)</div>
<div class="line">target_link_libraries(my_app spp::spp)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21"></a>
Project compilation</h2>
<div class="fragment"><div class="line">mkdir build-target</div>
<div class="line">cd build-target</div>
<div class="line">cmake -DCMAKE_TOOLCHAIN_FILE=../arm-linux-gnueabihf.cmake ..</div>
<div class="line">make</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md22"></a>
Troubleshooting</h1>
<h2><a class="anchor" id="autotoc_md23"></a>
Error: "Compiler not found"</h2>
<div class="fragment"><div class="line"># Verify toolchain is in PATH</div>
<div class="line">which arm-linux-gnueabihf-gcc</div>
<div class="line">export PATH=$PATH:/path/to/toolchain/bin</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md24"></a>
Error: "Cannot find libraries"</h2>
<div class="fragment"><div class="line"># Configure PKG_CONFIG_PATH</div>
<div class="line">export PKG_CONFIG_PATH=/opt/spp-arm/lib/pkgconfig:$PKG_CONFIG_PATH</div>
<div class="line"> </div>
<div class="line"># Or use CMAKE_PREFIX_PATH</div>
<div class="line">cmake -DCMAKE_PREFIX_PATH=/opt/spp-arm ..</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md25"></a>
Error: "Wrong architecture"</h2>
<div class="fragment"><div class="line"># Clean previous build</div>
<div class="line">rm -rf build-*</div>
<div class="line">./build.sh -c -x arm</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md26"></a>
Architecture-Specific Optimizations</h1>
<h2><a class="anchor" id="autotoc_md27"></a>
ARM Cortex-A Series</h2>
<div class="fragment"><div class="line"># In the toolchain file</div>
<div class="line">set(CMAKE_C_FLAGS &quot;${CMAKE_C_FLAGS} -mcpu=cortex-a53 -mfpu=neon-fp-armv8&quot;)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md28"></a>
RISC-V with specific extensions</h2>
<div class="fragment"><div class="line"># In the toolchain file</div>
<div class="line">set(CMAKE_C_FLAGS &quot;${CMAKE_C_FLAGS} -march=rv64imafd -mabi=lp64d&quot;)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md29"></a>
Testing Cross-Compiled Libraries</h1>
<h2><a class="anchor" id="autotoc_md30"></a>
Using QEMU</h2>
<div class="fragment"><div class="line"># Install QEMU</div>
<div class="line">sudo apt-get install qemu-user-static</div>
<div class="line"> </div>
<div class="line"># Run ARM binary on x86_64</div>
<div class="line">qemu-arm-static -L /usr/arm-linux-gnueabihf/ ./my_app_arm</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md31"></a>
Automated testing</h2>
<div class="fragment"><div class="line"># Run tests using QEMU</div>
<div class="line">ctest -VV</div>
<div class="line"> </div>
<div class="line"># Or with custom test runner</div>
<div class="line">./run_tests.sh arm</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
